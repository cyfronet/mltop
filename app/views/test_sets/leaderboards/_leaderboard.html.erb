<table class="table-auto border-collapse w-full border text-zinc-900 border-zinc-400 bg-zinc-50 dark:bg-zinc-700 dark:border-zinc-600 dark:text-zinc-200 text-sm shadow-sm">
  <thead class="sticky top-0">
    <tr>
      <th colspan="1" rowspan="2" class="border border-zinc-300 dark:border-zinc-600 font-semibold p-4 text-left">
        Models
      </th>
      <% task.metrics.each do |metric| %>
        <th rowspan="2" class="border border-zinc-300 dark:border-zinc-600 font-semibold p-4 text-center">
          <%= link_to test_set_leaderboard_path(test_set, tid: task.id, mid: metric.id, o: aggregated_metric_order(metric)), class: "flex items-center justify-center" do %>
            <span class="mr-3"><%= metric.name %></span>
            <%= aggregated_metric_sort_chevron(metric) %>
          <% end %>
        </th>
      <% end %>
      <% @test_set_entries.each do |test_set_entry| %>
        <th colspan="<%= task.metrics.size %>" class="border border-zinc-300 dark:border-zinc-600 font-semibold p-4 text-center">
          <%= test_set_entry %>
        </th>
      <% end %>
    </tr>
    <tr>
      <% @test_set_entries.each do |test_set_entry| %>
        <% task.metrics.each do |metric| %>
          <th class="border border-zinc-300 dark:border-zinc-600 font-semibold p-4 text-center">
            <%= link_to test_set_leaderboard_path(test_set, tid: task.id, mid: metric.id, sid: test_set_entry.id, o: test_set_metric_order(test_set_entry, metric)), class: "flex items-center justify-center" do %>
              <span class="mr-3"><%= metric.name %></span>
              <%= test_set_sort_chevron(test_set_entry, metric) %>
            <% end %>
          </th>
        <% end %>
      <% end %>
    </tr>
  </thead>
  <tbody>
    <% rows.each do |row| %>
      <tr>
        <td class="border border-zinc-300 dark:border-zinc-600 p-4 font-semibold">
          <%= link_to row.name, row.model %>
        </td>

        <% task.metrics.each do |metric| %>
          <%- value = row.score(test_set: test_set, metric:).value %>
          <td class="border border-zinc-300 dark:border-zinc-600 p-4 text-center text-zinc-900 font-semibold"
              style="background-color: <%= interpolate_color(value) %>">
            <%= number_with_precision value, precision: 2 %>
          </td>
        <% end %>

        <% @test_set_entries.each do |test_set_entry| %>
          <% task.metrics.each do |metric| %>
            <%- value = row.score(test_set: test_set, metric:, test_set_entry:).value %>

            <td class="border border-zinc-300 dark:border-zinc-600 p-4 text-center text-zinc-900 font-semibold"
                style="background-color: <%= interpolate_color(value) %>">
              <%= number_with_precision value, precision: 2 %>
            </td>
          <% end %>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>
